<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploy Microservices :: Cloud Native Apps</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/cloud-native-apps/cloud-native-apps/03-deploy.html">
    <link rel="prev" href="02-codeready.html">
    <link rel="next" href="04-monitor.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://redhat-scholars.github.io/cloud-native-apps">Cloud Native Apps</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cloud-native-apps" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Cloud Native Apps</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#rhodc">Red Hat OpenShift development cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#wto">Web Terminal Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="02-codeready.html">2. Access your OpenShift Dev Spaces</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-deploy.html">3. Deploy Microservices </a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#helm">Deploy a Quarkus MicroService with Helm</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#odo">Deploy a Spring Boot Microservice</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#yaml">Deploy Gateway Service using YAML</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#git">Deploy Web UI from Git </a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-monitor.html">4. Monitor Application Health</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#understanding_liveness"> Understanding Liveness Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#configuring_liveness">Configuring Liveness Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#testing_liveness">Testing Liveness Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#understanding_readiness"> Understanding Readiness Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#configuring_readiness"> Configuring Readiness Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#testing_Readiness"> Testing Readiness Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#understanding_startup"> Understanding Startup Probes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#monitoring_all_applications"> Monitoring All Application Healths</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-monitor.html#monitoring_application_metrics"> Monitoring Applications Metrics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-links.html">5. Next steps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-links.html#modernizingjavabook">Get the Book</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-links.html#rhd">Join the Red Hat Developer program!</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cloud Native Apps</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Cloud Native Apps</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Cloud Native Apps</a></li>
    <li><a href="03-deploy.html">3. Deploy Microservices </a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/cloud-native-apps/edit/master/documentation/modules/ROOT/pages/03-deploy.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Deploy Microservices</h1>
<div class="sect1">
<h2 id="helm"><a class="anchor" href="#helm"></a>Deploy a Quarkus MicroService with Helm</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>15 MINUTE EXERCISE</em></p>
</div>
<div class="paragraph">
<p>In this section you will learn about deploying microservices using Helm Charts.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/coolstore-arch-inventory-quarkus.png" alt="CoolStore Architecture" width="400">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="_images/quarkus-logo.png" alt="Quarkus" width="500">
</div>
</div>
<div class="paragraph">
<p><a href="https://quarkus.io/" target="_blank" rel="noopener">Quarkus</a> is a Kubernetes Native Java stack tailored for GraalVM &amp; OpenJDK HotSpot,
crafted from the best of breed Java libraries and standards.</p>
</div>
<div class="paragraph">
<p><strong>Container First</strong>: <a href="https://quarkus.io/" target="_blank" rel="noopener">Quarkus</a> tailors your application for GraalVM and HotSpot. Amazingly fast boot time, incredibly low RSS memory
(not just heap size!) offering near instant scale up and high density memory utilization in container orchestration platforms
like Kubernetes. We use a technique we call <a href="https://quarkus.io/container-first/" target="_blank" rel="noopener">compile time boot</a>.</p>
</div>
<div class="paragraph">
<p><strong>Unifies Imperative and Reactive</strong>: Combine both the familiar <a href="https://quarkus.io/continuum/" target="_blank" rel="noopener">imperative code and the non-blocking reactive style</a> when developing applications</p>
</div>
<div class="paragraph">
<p><strong>Developer Joy</strong>: A cohesive platform for optimized developer joy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unified configuration</p>
</li>
<li>
<p>Zero config, live reload in the blink of an eye</p>
</li>
<li>
<p>Streamlined code for the 80% common usages, flexible for the 20%</p>
</li>
<li>
<p>No hassle native executable generation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Best of Breed Libraries and Standards</strong>: Quarkus brings a cohesive, fun to use full-stack framework by leveraging best of breed libraries you
love and use wired on a <a href="https://quarkus.io/standards/" target="_blank" rel="noopener">standard backbone</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Next, we will use Helm to deploy the <code><a href="https://github.com/modernizing-java-applications-book/inventory-quarkus" class="bare">https://github.com/modernizing-java-applications-book/inventory-quarkus</a></code> application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to your Developer Sandbox for Red Hat OpenShift (the Web UI tab) and select <strong>Helm</strong> from the left hand side menu:</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/access-helm.png" alt="Access Helm" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Install a Helm Chart from the developer catalog</strong> link.</p>
</li>
<li>
<p>Type <code>Quarkus</code> in the input field associated with search function and click on the result found.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/helm-quarkus.png" alt="Quarkus" width="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <strong>Install Helm Chart</strong> button and follow the next steps to adjust the chart values.</p>
</li>
<li>
<p>Change the release name to <code>inventory-quarkus</code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/inventory-quarkus.png" alt="Inventory Quarkus" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <strong>Build</strong> section and expand it. Copy and paste the name of the repo: <code><a href="https://github.com/modernizing-java-applications-book/inventory-quarkus.git" class="bare">https://github.com/modernizing-java-applications-book/inventory-quarkus.git</a></code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/build-repo.png" alt="URI to repo" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Finally, click <strong>Install</strong> button to have your charts installed.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/openshift-inventory-helm.png" alt="Quarkus Helm chart deployed" width="400" height="400">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The installation with Helm takes a few minutes, you can check the progress by following the build logs from the view.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="odo"><a class="anchor" href="#odo"></a>Deploy a Spring Boot Microservice</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>20 MINUTES EXERCISE</em></p>
</div>
<div class="paragraph">
<p>In this section you will learn about deploying microservices using drag-and-drop feature of OpenShift Web Console.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/coolstore-arch-catalog-spring-boot.png" alt="CoolStore Architecture" width="400">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="_images/spring-boot-logo.png" alt="Spring Boot" width="400">
</div>
</div>
<div class="paragraph">
<p>Spring Boot is an opinionated framework that makes it easy to create stand-alone Spring based
applications with embedded web containers such as Tomcat (or JBoss Web Server), Jetty and Undertow
that you can run directly on the JVM using <strong>java -jar</strong>. Spring Boot also allows producing a war
file that can be deployed on stand-alone web containers.</p>
</div>
<div class="paragraph">
<p>The opinionated approach means many choices about Spring platform and third-party libraries
are already made by Spring Boot so that you can get started with minimum effort and configuration.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This exercise starts by going to your <code>OpenShift Dev Spaces</code> and create a new workspace using the following repository URL as input <code><a href="https://github.com/modernizing-java-applications-book/catalog-spring-boot.git" class="bare">https://github.com/modernizing-java-applications-book/catalog-spring-boot.git</a></code> via <strong>Quick Add</strong>:</p>
</div>
<div class="imageblock mt-4 center">
<div class="content">
<img src="_images/dev-spaces-quick-add-create-workspace.png" alt="Quick Add to Create Workspace">
</div>
</div>
<div class="paragraph">
<p>Then click <strong>Create &amp; Open</strong> button to import the project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You might be asked to login through <a href="https://github.com" target="_blank" rel="noopener">GitHub.com</a> with your user in order to access OpenShift Dev Spaces. This is due the GitHub OAuth plugin available in OpenShift Dev Spaces that let start using GitHub features such as Pull Requests, Issues etc from the environment. If you don&#8217;t have a GitHub account, you can just skip it.
</td>
</tr>
</table>
</div>
<div class="imageblock mt-4 center">
<div class="content">
<img src="_images/dev-spaces-import-from-git.png" alt="Import Workspace from Git Repository">
</div>
</div>
<div class="paragraph">
<p>The import will generate a developer workspace containing the language support for Spring Boot and pre-built run configurations for building the app.</p>
</div>
<div class="paragraph">
<p>The format to define these workspaces is the <a href="https://devfile.io/docs/2.1.0/what-is-a-devfile" target="_blank" rel="noopener">Devfile</a>, a standard format to record the instructions for configuring and running your build environment as a YAML-formatted text file.</p>
</div>
<div class="paragraph">
<p>In the while your workspace is setup, you can review the Devfile available on the Catalog service repository <a href="https://github.com/modernizing-java-applications-book/catalog-spring-boot/blob/main/devfile.yaml" target="_blank" rel="noopener">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">schemaVersion: 2.1.0
metadata:
  name: catalog-spring-boot
components:
  - attributes:
      che-theia.eclipse.org/vscode-preferences:
        java.server.launchMode: Standard
    container:
      endpoints:
        - exposure: none
          name: debug
          protocol: tcp
          targetPort: 5005
        - exposure: public
          name: 8080-tcp
          protocol: http
          targetPort: 8080
      image: 'quay.io/devfile/universal-developer-image:ubi8-0e189d9'
      memoryLimit: 2Gi
      volumeMounts:
        - name: m2
          path: /home/user/.m2
    name: tools
  - name: m2
    volume:
      size: 1G
commands:
  - exec:
      commandLine: mvn clean install
      workingDir: '${PROJECT_SOURCE}'
      component: tools
      group:
        isDefault: true
        kind: build
    id: maven-build
  - exec:
      commandLine: java -jar target/*.jar
      workingDir: '${PROJECT_SOURCE}'
      component: tools
      group:
        isDefault: true
        kind: run
    id: run-with-hsqldb
  - exec:
      commandLine: 'java -jar -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005 target/*.jar'
      workingDir: '${PROJECT_SOURCE}'
      component: tools
      group:
        kind: run
    id: run-debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>The devfile can list IDE extensions requirement in-file or in another file named <code>.vscode/extensions.json</code> as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    // See https://go.microsoft.com/fwlink/?LinkId=827846
    // for the documentation about the extensions.json format
    "recommendations": [
      "redhat.java",
      "vscjava.vscode-java-debug",
      "vscjava.vscode-java-test",
      "redhat.vscode-yaml"
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
OpenShift Dev Spaces plugins are compatible with VSCode, see a list of available plugins from Red Hat <a href="https://marketplace.visualstudio.com/publishers/redhat">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After your workspace is up and running, locate the <code>/projects/catalog-spring-boot/src/main/resources/import.sql</code> file in the newly imported project:</p>
</div>
<div class="imageblock mt-4 center">
<div class="content">
<img src="_images/che-project-explorer-locate-file.png" alt="Locate File in Project Explorer">
</div>
</div>
<div class="paragraph">
<p>Add the following two lines of SQL into <code>import.sql</code>:</p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">INSERT INTO PRODUCT (item_id, name, description, price) VALUES ('444439', 'Organic Cotton Quarkus twill cap', '100% organic cotton twill cap with an unstructured, low-profile, six-panel design. The crown measures 3 1/8 and this features a Permacurv visor and a buckle closure with a grommet.',13.00 );
INSERT INTO PRODUCT (item_id, name, description, price) VALUES ('165623', 'Organic Cotton knit socks', 'Your brand will get noticed on these full color knit socks. Imported.',4.15);</code></pre>
</div>
</div>
<div class="imageblock mt-4 center">
<div class="content">
<img src="_images/che-editor-add-lines.png" alt="Add lines in Editor Window">
</div>
</div>
<div class="paragraph">
<p>Next go to <strong>Terminal</strong> &#8594; <strong>Run Tasks..</strong>  and select <strong>maven-build</strong></p>
</div>
<div class="imageblock mt-4 center">
<div class="content">
<img src="_images/run-maven.png" alt="Run Maven build">
</div>
</div>
<div class="paragraph">
<p>You should see a new terminal opening with the output of the build as follows:</p>
</div>
<div class="imageblock mt-4 center">
<div class="content">
<img src="_images/devspaces-maven-build.png" alt="Run Maven build in Dev Spaces">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also do it via CLI as follows: go to <strong>Terminal</strong> &#8594; <strong>Open Terminal in Specific Container</strong> and select a container with name <strong>tools</strong>.
A terminal window will open at the bottom of your editor and there you can input Maven commands such as <code>mvn clean install</code>.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/universal-devimage-container-run-mvn.png" alt="Run Maven in Terminal">
</div>
</div>
<div class="paragraph">
<p>After packaging the application, you can expand your target folder on left-hand side and observe the results:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/build-results.png" alt="Build results" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>You should download the build results by right-clicking and saving the jar on your local computer.
In order to deploy our recent build we will use this downloaded jar.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go back to the <strong>Topology view</strong> of your <code>Developer Sandbox for Red Hat OpenShift</code></p>
</li>
<li>
<p>Drag and drop the downloaded JAR into the Topology</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/drag-and-drop.png" alt="Drag and Drop JAR" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on +Add` button and locate the <code>Upload JAR File</code> option</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/upload-jar.png" alt="Upload jar" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>Then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Upload JAR file dialog, browse the location of the jar from your local computer and modify the <strong><code>Builder Image Version</code></strong> to be <code>openjdk-11-el7</code>. Optionally, you can also modify the <strong><code>Runtime icon</code></strong> to <code>spring-boot</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/upload-jar-file-dialog-settings-1.png" alt="JAR Upload Dialog" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong><code>General Section</code></strong> choose <code>Create Application</code> from the <strong><code>Application</code></strong>  drop-down , use <code>coolstore</code> as the <strong><code>Application name</code></strong> and set the <strong><code>Name</code></strong> to <code>catalog-spring-boot</code>:</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/upload-jar-file-dialog-settings-2.png" alt="JAR Upload Dialog" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Press the <strong>Create</strong> button.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can validate your deployment by accessing the application via its route url:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/route.png" alt="Route" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>This will open a new browser tab and you should see something similar to:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/test-it.png" alt="Test it" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>Then <code><strong>click on 'Test it'</strong></code>. You should have a similar array of json output:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The JSON output  here has been beautified
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "itemId": "100000",
    "name": "Red Fedora",
    "description": "Official Red Hat Fedora",
    "price": 34.99
  },
  {
    "itemId": "329299",
    "name": "Quarkus T-shirt",
    "description": "This updated unisex essential fits like a well-loved favorite, featuring a crew neck, short sleeves and designed with superior combed and ring- spun cotton.",
    "price": 10
  },
  {
    "itemId": "329199",
    "name": "Pronounced Kubernetes",
    "description": "Kubernetes is changing how enterprises work in the cloud. But one of the biggest questions people have is: How do you pronounce it?",
    "price": 9
  },
  {
    "itemId": "165613",
    "name": "Knit socks",
    "description": "Your brand will get noticed on these full color knit socks. Imported.",
    "price": 4.15
  },
  {
    "itemId": "165614",
    "name": "Quarkus H2Go water bottle",
    "description": "Sporty 16. 9 oz double wall stainless steel thermal bottle with copper vacuum insulation, and threaded insulated lid. Imprinted. Imported.",
    "price": 14.45
  },
  {
    "itemId": "165954",
    "name": "Patagonia Refugio pack 28L",
    "description": "Made from 630-denier 100% nylon (50% recycled/50% high-tenacity) plain weave; lined with 200-denier 100% recycled polyester. ...",
    "price": 6
  },
  {
    "itemId": "444434",
    "name": "Red Hat Impact T-shirt",
    "description": "This 4. 3 ounce, 60% combed ringspun cotton/40% polyester jersey t- shirt features a slightly heathered appearance. The fabric laundered for reduced shrinkage. Next Level brand apparel. Printed.",
    "price": 9
  },
  {
    "itemId": "444435",
    "name": "Quarkus twill cap",
    "description": "100% cotton chino twill cap with an unstructured, low-profile, six-panel design. The crown measures 3 1/8 and this features a Permacurv visor and a buckle closure with a grommet.",
    "price": 13
  },
  {
    "itemId": "444437",
    "name": "Nanobloc Universal Webcam Cover",
    "description": "NanoBloc Webcam Cover fits phone, laptop, desktop, Pc, MacBook Pro, iMac, ...",
    "price": 2.75
  }
]</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can make the previous Helm installation of the Quarkus microservice part of your <code>coolstore</code> application by editing its labels and adding <code>app.kubernetes.io/part-of=coolstore</code>. You can also drag and drop it to the <code>coolstore</code> app by pressing CTRL command.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/edit-labels.png" alt="Edit labels" width="600" height="600">
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Well done! You are ready to move on to the next section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="yaml"><a class="anchor" href="#yaml"></a>Deploy Gateway Service using YAML</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>10 MINUTES EXERCISE</em></p>
</div>
<div class="paragraph">
<p>During this section you will deploy a scalable API Gateway that aggregates Catalog and Inventory APIs using Eclipse Vert.x</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="_images/vertx-logo.png" alt="Vertx" width="400"></span></p>
</div>
<div class="paragraph">
<p><a href="http://vertx.io/" target="_blank" rel="noopener">Eclipse Vert.x</a> is a toolkit for building reactive applications on the Java Virtual Machine (JVM). Vert.x does not
impose a specific framework or packaging model and can be used within your existing applications and frameworks
in order to add reactive functionality by just adding the Vert.x jar files to the application classpath.</p>
</div>
<div class="paragraph">
<p><a href="http://vertx.io/" target="_blank" rel="noopener">Eclipse Vert.x</a> enables building reactive systems as defined by <a href="http://www.reactivemanifesto.org" target="_blank" rel="noopener">The Reactive Manifesto</a> and build
services that are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Responsive</strong>: to handle requests in a reasonable time</p>
</li>
<li>
<p><strong>Resilient</strong>: to stay responsive in the face of failures</p>
</li>
<li>
<p><strong>Elastic</strong>: to stay responsive under various loads and be able to scale up and down</p>
</li>
<li>
<p><strong>Message driven</strong>: components interact using asynchronous message-passing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://vertx.io/" target="_blank" rel="noopener">Eclipse Vert.x</a> is designed to be event-driven and non-blocking. Events are delivered in an event loop that must never be blocked. Unlike traditional applications, Vert.x uses a very small number of threads responsible for dispatching the events to event handlers. If the event loop is blocked, the events won’t be delivered anymore and therefore the code needs to be mindful of this execution model.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>For this type of deployment we can use YAML files already available at <a href="https://github.com/modernizing-java-applications-book/gateway-vertx.git" class="bare">https://github.com/modernizing-java-applications-book/gateway-vertx.git</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to your <code>Developer Sandbox for Red Hat OpenShift</code>.</p>
</li>
<li>
<p>Click on <strong>+Add</strong> button and locate <strong>From Local Machine</strong> option, then select <strong>From YAML</strong></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/from-yaml.png" alt="From YAML" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the following YAML containing the Kubernetes manifests describing the API Gateway for the Coolstore. You find it also in the GitHub repository <a href="https://github.com/modernizing-java-applications-book/gateway-vertx/blob/main/kubernetes/gateway-vertx.yaml" target="_blank" rel="noopener">here</a>.</p>
</li>
</ul>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
kind: Deployment <i class="conum" data-value="1"></i><b>(1)</b>
apiVersion: apps/v1
metadata:
  name: gateway-vertx
  labels:
    app: gateway-vertx
    app.kubernetes.io/component: gateway-vertx
    app.kubernetes.io/instance: gateway-vertx
    app.kubernetes.io/name: vertx
    app.kubernetes.io/part-of: coolstore
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gateway-vertx
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: gateway-vertx
    spec:
      containers:
        - name: gateway-vertx
          image: quay.io/modernizingjavaappsbook/gateway-vertx:latest <i class="conum" data-value="2"></i><b>(2)</b>
          ports:
            - containerPort: 8080
              protocol: TCP
            - containerPort: 8443
              protocol: TCP
            - containerPort: 8778
              protocol: TCP
          env: <i class="conum" data-value="3"></i><b>(3)</b>
            - name: COMPONENT_CATALOG_HOST
              value: catalog-spring-boot
            - name: COMPONENT_CATALOG_PORT
              value: '8080'
            - name: COMPONENT_INVENTORY_HOST
              value: inventory-quarkus
            - name: COMPONENT_INVENTORY_PORT
              value: '8080'
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          imagePullPolicy: Always
      restartPolicy: Always
      terminationGracePeriodSeconds: 30
      dnsPolicy: ClusterFirst
      securityContext: {}
      schedulerName: default-scheduler
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 25%
      maxSurge: 25%
  revisionHistoryLimit: 10
  progressDeadlineSeconds: 600
---
kind: Service <i class="conum" data-value="4"></i><b>(4)</b>
apiVersion: v1
metadata:
  name: gateway-vertx
  labels:
    app: gateway-vertx
    app.kubernetes.io/component: gateway-vertx
    app.kubernetes.io/instance: gateway-vertx
    app.kubernetes.io/part-of: coolstore
spec:
  ports:
    - name: 8080-tcp
      protocol: TCP
      port: 8080
      targetPort: 8080
    - name: 8443-tcp
      protocol: TCP
      port: 8443
      targetPort: 8443
    - name: 8778-tcp
      protocol: TCP
      port: 8778
      targetPort: 8778
  selector:
    app: gateway-vertx
  type: ClusterIP
  sessionAffinity: None
---
kind: Route <i class="conum" data-value="5"></i><b>(5)</b>
apiVersion: route.openshift.io/v1
metadata:
  name: gateway-vertx
  labels:
    app: gateway-vertx
    app.kubernetes.io/component: gateway-vertx
    app.kubernetes.io/instance: gateway-vertx
    app.kubernetes.io/part-of: coolstore
spec:
  to:
    kind: Service
    name: gateway-vertx
    weight: 100
  port:
    targetPort: 8080-tcp
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  wildcardPolicy: None</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A Kubernetes Deployment for this app.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The container image for the Gateway service available on Quay.io</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Environments variable to instruct the Gateway on what to connect, in this case the Inventory and the Catalog Kubernetes Services</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A Kubernetes Service for the Gateway</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A secure OpenShift Route for accessing the Gateway via an HTTPS URL
<div class="ulist">
<ul>
<li>
<p>Now paste using control-v or command-v the YAML content in your sandbox and hit <strong>Create</strong> button.</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/import-yaml.png" alt="Import YAML" width="600" height="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You should see the following results:</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/successful-yaml-import.png" alt="Successful YAML import" width="600" height="600">
</div>
</div>
<div class="paragraph">
<p>Go back to the <strong>Topology</strong>, go to the newly created <code>gateway-vertx</code> and click to the little arrow as shown below, this will open the Gateway URL:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/openshift-gateway-route.png" alt="Gateway Vertx Route" width="400" height="400">
</div>
</div>
<div class="paragraph">
<p>You can find the Route also by navigating to <strong>OpenShift Web Console &#8594; Project &#8594; Routes</strong> :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/gateway-service-url.png" alt="Gateway Service URL" width="700">
</div>
</div>
<div class="paragraph">
<p>Or the OpenShift CLI inside the Web Terminal:</p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route gateway-vertx</code></pre>
</div>
</div>
<div class="paragraph">
<p>By accessing the URL from the just created OpenShift Route, you should see something similar to the following:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/vertx-testit.png" alt="Test it" width="400" height="400">
</div>
</div>
<div class="paragraph">
<p>Then <code><strong>click on 'Test it'</strong></code>. You should have a similar array of json output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[ {
  "itemId" : "165613",
  "name" : "Knit socks",
  "description" : "Your brand will get noticed on these full color knit socks. Imported.",
  "price" : 4.15,
  "availability" : {
    "quantity" : 45
  }
}, {
  "itemId" : "100000",
  "name" : "Red Fedora",
  "description" : "Official Red Hat Fedora",
  "price" : 34.99,
  "availability" : {
    "quantity" : 0
  }
}, {
  "itemId" : "329299",
  "name" : "Quarkus T-shirt",
  "description" : "This updated unisex essential fits like a well-loved favorite, featuring a crew neck, short sleeves and designed with superior combed and ring- spun cotton.",
  "price" : 10.0,
  "availability" : {
    "quantity" : 35
  }
}, {
  "itemId" : "165614",
  "name" : "Quarkus H2Go water bottle",
  "description" : "Sporty 16. 9 oz double wall stainless steel thermal bottle with copper vacuum insulation, and threaded insulated lid. Imprinted. Imported.",
  "price" : 14.45,
  "availability" : {
    "quantity" : 87
  }
}, {
  "itemId" : "329199",
  "name" : "Pronounced Kubernetes",
  "description" : "Kubernetes is changing how enterprises work in the cloud. But one of the biggest questions people have is: How do you pronounce it?",
  "price" : 9.0,
  "availability" : {
    "quantity" : 12
  }
}, {
  "itemId" : "165954",
  "name" : "Patagonia Refugio pack 28L",
  "description" : "Made from 630-denier 100% nylon (50% recycled/50% high-tenacity) plain weave; lined with 200-denier 100% recycled polyester. ...",
  "price" : 6.0,
  "availability" : {
    "quantity" : 43
  }
}, {
  "itemId" : "444434",
  "name" : "Red Hat Impact T-shirt",
  "description" : "This 4. 3 ounce, 60% combed ringspun cotton/40% polyester jersey t- shirt features a slightly heathered appearance. The fabric laundered for reduced shrinkage. Next Level brand apparel. Printed.",
  "price" : 9.0,
  "availability" : {
    "quantity" : 32
  }
}, {
  "itemId" : "444437",
  "name" : "Nanobloc Universal Webcam Cover",
  "description" : "NanoBloc Webcam Cover fits phone, laptop, desktop, Pc, MacBook Pro, iMac, ...",
  "price" : 2.75
}, {
  "itemId" : "444435",
  "name" : "Quarkus twill cap",
  "description" : "100% cotton chino twill cap with an unstructured, low-profile, six-panel design. The crown measures 3 1/8 and this features a Permacurv visor and a buckle closure with a grommet.",
  "price" : 13.0,
  "availability" : {
    "quantity" : 53
  }
} ]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="git"><a class="anchor" href="#git"></a>Deploy Web UI from Git</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>15 MINUTES EXERCISE</em></p>
</div>
<div class="paragraph">
<p>The Web UI is built using Node.js for server-side JavaScript and AngularJS for client-side
JavaScript. Let&#8217;s deploy it on OpenShift using the certified Node.js container image available
in OpenShift.</p>
</div>
<div class="paragraph">
<p>In this section, you will fully use OpenShift <a href="https://docs.openshift.com/container-platform/4.10/cicd/builds/understanding-image-builds.html" target="_blank" rel="noopener">Source-to-Image (S2I)</a>.
OpenShift will obtain the application code directly from the source repository then build and deploy a
container image of it.</p>
</div>
<div class="paragraph">
<p>In the OpenShift Web Console, from the <strong>Developer view</strong>,
<code><strong>click on '+Add' and select 'Import from Git'</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/dev-view-add-git-import.png" alt="OpenShift - Add from Git">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In the Git Import dialog fill in the <strong><code>Git Repo URL</code></strong> with <code><a href="https://github.com/modernizing-java-applications-book/web-nodejs.git" class="bare">https://github.com/modernizing-java-applications-book/web-nodejs.git</a></code>. Next click <code>show advanced Git options</code> to update the <strong><code>Git reference</code></strong> to <code>main</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/git-import-dialog-1.png" alt="Git Repo URL and reference" width="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Further below in the dialog you will see the following notes about import strategies.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/git-import-dialog-2.png" alt="Import Strategy" width="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Edit Import Strategy</strong>, select
the <strong><code>Builder Image</code></strong> strategy and OpenShift will autodetect the runtime needed by the code, which in this case should be Node.js</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/git-import-dialog-3.png" alt="Builder Image Strategy">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the <strong>Application</strong>, select <code>coolstore</code></p>
</li>
<li>
<p>Scroll down to the bottom of the dialog where you see the following options.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/git-import-dialog-4.png" alt="Builder Image Strategy" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Deployment</strong> the expand the section and add an environment variable. The environment variable name is <code>SECURE_COOLSTORE_GW_ENDPOINT</code> and the value is the URL associated with the Route to Gateway Service that you used in the previous section.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/git-import-dialog-5.png" alt="Builder Image Strategy" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Press <strong><code>Create</code></strong> button to finish the deployment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The final view of the deployed applications should be similar to this one:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openshift-all-deployed.png" alt="Deployments Overview" width="700">
</div>
</div>
<div class="paragraph">
<p>You can also connect all microservices just from a visualization point of view as the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/final-overview.png" alt="Deployments Overview" width="700">
</div>
</div>
<div class="paragraph">
<p>You can check the deployed application by accessing the Route of the last deployment <code>web-nodejs</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://github.com/modernizing-java-applications-book/web-nodejs/blob/main/coolstore-web.png?raw=true" alt="Coolstore Shop" width="600">
</div>
</div>
<div class="paragraph">
<p>Congrats!! You have implemented an e-store using a microservices based architecture!</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-codeready.html" class="query-params-link">2. Access your OpenShift Dev Spaces</a></span>
  <span class="next"><a href="04-monitor.html" class="query-params-link">4. Monitor Application Health</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
